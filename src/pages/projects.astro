---
import Layout from '../layouts/Layout.astro';
import GlassCard from '../components/GlassCard.astro';
import GlassButton from '../components/GlassButton.astro';
import { getProjects } from '../lib/supabase';

export const prerender = false; // 确保动态渲染

// 从 Supabase 获取项目数据
const projects = await getProjects();

// 状态映射函数
function getStatusDisplay(status: string) {
  const statusMap = {
    'active': 'Active',
    'maintained': 'Maintained',
    'archived': 'Archived'
  };
  return statusMap[status as keyof typeof statusMap] || status;
}

// 状态样式函数
function getStatusStyle(status: string) {
  const styleMap = {
    'active': 'background: rgba(16, 185, 129, 0.1); color: #059669; border: 1px solid rgba(16, 185, 129, 0.2);',
    'maintained': 'background: rgba(59, 130, 246, 0.1); color: #2563eb; border: 1px solid rgba(59, 130, 246, 0.2);',
    'archived': 'background: rgba(107, 114, 128, 0.1); color: #6b7280; border: 1px solid rgba(107, 114, 128, 0.2);'
  };
  return styleMap[status as keyof typeof styleMap] || styleMap.active;
}
---

<Layout title="Projects | Your Name">
  <div class="max-w-4xl mx-auto">
    <!-- 页面标题 -->
    <GlassCard class="p-8 mb-8 text-center fade-in">
      <h1 class="text-4xl font-bold mb-4" style="color: var(--text-primary);">
        🚀 Projects
      </h1>
      <p class="text-lg" style="color: var(--text-secondary);">
        Here are some of the projects I've been working on. From SaaS products to open-source libraries,
        I enjoy building things that solve real problems.
      </p>
    </GlassCard>

    <!-- 项目网格 -->
    {projects.length > 0 ? (
      <div class="grid gap-6 md:grid-cols-2">
        {projects.map((project, index) => (
        <GlassCard class="p-6 slide-up" style={`animation-delay: ${index * 100}ms;`}>
          <div class="flex items-start justify-between mb-4">
            <h2 class="text-xl font-semibold">
              {project.slug ? (
                <a href={`/projects/${project.slug}`} class="text-primary hover:text-blue-600 transition-colors">
                  {project.title}
                </a>
              ) : (
                <span style="color: var(--text-primary);">{project.title}</span>
              )}
            </h2>
            <span
              class="px-3 py-1 text-xs font-medium rounded-full"
              style={getStatusStyle(project.status)}
            >
              {getStatusDisplay(project.status)}
            </span>
          </div>

          <p class="mb-4" style="color: var(--text-secondary); line-height: 1.6;">
            {project.description}
          </p>

          <div class="flex flex-wrap gap-2 mb-4">
            {project.technologies.map((tech) => (
              <span
                class="px-2 py-1 text-xs rounded"
                style="background: var(--bg-tertiary); color: var(--text-tertiary); border: 1px solid var(--border-light);"
              >
                {tech}
              </span>
            ))}
          </div>

          <div class="flex gap-2">
            {project.slug && (
              <GlassButton variant="primary" size="sm" href={`/projects/${project.slug}`}>
                查看详情
              </GlassButton>
            )}
            {project.url && (
              <GlassButton variant="secondary" size="sm" href={project.url}>
                访问项目
              </GlassButton>
            )}
            {project.github_url && (
              <GlassButton variant="secondary" size="sm" href={project.github_url}>
                GitHub
              </GlassButton>
            )}
          </div>
        </GlassCard>
        ))}
      </div>
    ) : (
      <!-- 空状态 -->
      <GlassCard class="p-8 text-center">
        <div class="text-6xl mb-4">🚧</div>
        <h2 class="text-2xl font-semibold mb-4" style="color: var(--text-primary);">
          No Projects Yet
        </h2>
        <p style="color: var(--text-secondary); line-height: 1.6;">
          Projects are being added soon. Check back later to see what I'm working on!
        </p>
      </GlassCard>
    )}

    <!-- 合作邀请 -->
    <GlassCard class="p-8 mt-8 text-center slide-up" style="animation-delay: 300ms;">
      <h2 class="text-2xl font-semibold mb-4" style="color: var(--text-primary);">
        💡 Want to collaborate?
      </h2>
      <p class="mb-6" style="color: var(--text-secondary); line-height: 1.6;">
        I'm always interested in working on exciting projects. If you have an idea you'd like to discuss,
        feel free to reach out!
      </p>
      <div class="flex justify-center gap-4">
        <GlassButton variant="primary" size="lg" href="mailto:your@email.com">
          Get in touch
        </GlassButton>
        <GlassButton variant="secondary" size="lg" href="/about">
          About Me
        </GlassButton>
      </div>
    </GlassCard>
  </div>
</Layout>
