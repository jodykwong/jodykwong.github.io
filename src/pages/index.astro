---
import Layout from '../layouts/Layout.astro';
import GlassCard from '../components/GlassCard.astro';
import GlassButton from '../components/GlassButton.astro';
import { getPersonalInfo, getProfileContentBySection } from '../lib/supabase';

export const prerender = false; // ç¡®ä¿åŠ¨æ€æ¸²æŸ“

// è·å–ä¸ªäººä¿¡æ¯å’Œå†…å®¹
const personalInfo = await getPersonalInfo();
const currentFocusContent = await getProfileContentBySection('current_focus');
const writingContent = await getProfileContentBySection('writing_sharing');
const experienceContent = await getProfileContentBySection('experience');

// é»˜è®¤å€¼
const defaultPersonalInfo = {
  name: "Your Name",
  title: "Full-Stack Developer, Maker of Products, and Solopreneur",
  bio: "I'm a software developer and entrepreneur. I also write occasionally.",
  avatar_url: "/images/avatar.jpg"
};

const defaultCurrentFocus = "These days I mostly work on My SaaS Product: the amazing boilerplate. I also made My Cool Appâ€”what I hope is the best way to solve a specific problem on the internet.";
const defaultWriting = "This site originated during a six-month sabbatical I took from my day job where I tried to launch a profitable product. I documented that journey here. I also write occasionally about building software.";
const defaultExperience = "From 2015-2023 I served as CTO of Amazing Company and led the team that builds its flagship product: Awesome Product. I'm now an advisor to the organization.";

// ä½¿ç”¨æ•°æ®åº“å†…å®¹æˆ–é»˜è®¤å€¼
const displayInfo = personalInfo || defaultPersonalInfo;
const displayCurrentFocus = currentFocusContent?.content || defaultCurrentFocus;
const displayWriting = writingContent?.content || defaultWriting;
const displayExperience = experienceContent?.content || defaultExperience;
---

<Layout title={`${displayInfo.name} | ${displayInfo.title}`}>
  <div class="max-w-4xl mx-auto">
    <!-- ä¸»è¦ä»‹ç»å¡ç‰‡ -->
    <GlassCard class="p-8 mb-8 fade-in">
      <div class="flex flex-col md:flex-row items-start gap-8">
        <div class="flex-shrink-0">
          <div class="relative">
            <img
              src={displayInfo.avatar_url}
              alt={`Hi, I'm ${displayInfo.name}`}
              class="w-32 h-32 rounded-full object-cover"
              style="border: 3px solid var(--border-light); box-shadow: var(--shadow-glass);"
            />
            <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-green-500 rounded-full border-4 border-white" style="border-color: var(--bg-primary);"></div>
          </div>
        </div>

        <div class="flex-1">
          <h1 class="text-4xl md:text-5xl font-bold mb-4" style="color: var(--text-primary);"
              data-i18n="home.greeting"
              data-i18n-params={JSON.stringify({name: displayInfo.name})}>
            ä½ å¥½ï¼Œæˆ‘æ˜¯ {displayInfo.name}ã€‚
          </h1>
          <p class="text-xl mb-6" style="color: var(--text-secondary);">
            {displayInfo.bio}
          </p>
          <div class="flex flex-wrap gap-3">
            <GlassButton variant="primary" size="md" href="/projects">
              <span data-i18n="home.viewProjects">æŸ¥çœ‹é¡¹ç›®</span>
            </GlassButton>
            <GlassButton variant="secondary" size="md" href="/about">
              <span data-i18n="home.aboutMe">å…³äºæˆ‘</span>
            </GlassButton>
          </div>
        </div>
      </div>
    </GlassCard>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="grid gap-6">
      <!-- å½“å‰å·¥ä½œ -->
      <GlassCard class="p-6 slide-up">
        <h2 class="text-2xl font-bold mb-4" style="color: var(--text-primary);" data-i18n="home.currentWork">
          ğŸš€ å½“å‰å·¥ä½œ
        </h2>
        <p class="mb-4" style="color: var(--text-secondary); line-height: 1.7;" set:html={displayCurrentFocus}>
        </p>
        <div class="flex flex-wrap gap-2">
          <GlassButton variant="secondary" size="sm" href="/projects">
            <span data-i18n="home.fullProjectList">å®Œæ•´é¡¹ç›®åˆ—è¡¨</span>
          </GlassButton>
          <GlassButton variant="secondary" size="sm" href="/open">
            <span data-i18n="home.openDashboard">é¡¹ç›®ä»ªè¡¨æ¿</span>
          </GlassButton>
        </div>
      </GlassCard>

      <!-- å†™ä½œå’Œåˆ†äº« -->
      <GlassCard class="p-6 slide-up" style="animation-delay: 100ms;">
        <h2 class="text-2xl font-bold mb-4" style="color: var(--text-primary);" data-i18n="home.writingSharing">
          âœï¸ å†™ä½œåˆ†äº«
        </h2>
        <p class="mb-4" style="color: var(--text-secondary); line-height: 1.7;" set:html={displayWriting}>
        </p>
        <div class="flex flex-wrap gap-2">
          <GlassButton variant="secondary" size="sm" href="/writing">
            <span data-i18n="home.readWriting">é˜…è¯»æˆ‘çš„æ–‡ç« </span>
          </GlassButton>
          <GlassButton variant="secondary" size="sm" href="/software">
            <span data-i18n="home.viewSoftware">æŸ¥çœ‹è½¯ä»¶é¡¹ç›®</span>
          </GlassButton>
        </div>
      </GlassCard>

      <!-- ç»éªŒèƒŒæ™¯ -->
      <GlassCard class="p-6 slide-up" style="animation-delay: 200ms;">
        <h2 class="text-2xl font-bold mb-4" style="color: var(--text-primary);" data-i18n="home.experience">
          ğŸ’¼ å·¥ä½œç»å†
        </h2>
        <p class="mb-4" style="color: var(--text-secondary); line-height: 1.7;" set:html={displayExperience}>
        </p>
        <GlassButton variant="secondary" size="sm" href="/about">
          <span data-i18n="home.aboutMe">å…³äºæˆ‘</span>
        </GlassButton>
      </GlassCard>
    </div>
  </div>
</Layout>
