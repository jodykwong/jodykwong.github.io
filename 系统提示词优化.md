# 系统提示词优化

## 版本 0.1 技术经验总结

### CSS 样式在生产环境的处理规范
```
CSS 导入最佳实践（2025-06-27 更新）：
1. 在 Astro 项目中，必须在 frontmatter 中导入 CSS 文件
2. 避免在 HTML 中使用 <link> 标签引用 /src/ 路径
3. 使用 import '../styles/filename.css' 确保构建时正确处理
4. 验证构建产物中 CSS 文件包含预期的样式内容
5. 对于 glassmorphism 等自定义样式，特别注意导入方式

错误示例：
<link rel="stylesheet" href="/src/styles/glassmorphism.css" />

正确示例：
---
import '../styles/glassmorphism.css';
---

适用场景：所有需要自定义 CSS 的 Astro 项目
关键问题：生产环境样式丢失
更新：2025-06-27 解决了 GitHub Pages 部署中的样式问题
```

### 动态数据获取 vs 硬编码数据规范
```
数据获取最佳实践（2025-06-27 更新）：
1. 避免在页面中使用硬编码数据数组
2. 使用 export const prerender = false 确保动态渲染
3. 通过 Supabase API 函数动态获取数据
4. 确保数据结构与数据库 schema 匹配
5. 实现空状态和错误处理

错误示例：
const projects = [
  { title: "...", tech: ["React"] }  // 硬编码 + 字段不匹配
];

正确示例：
export const prerender = false;
const projects = await getProjects();  // 动态获取
{project.technologies.map(...)}       // 正确字段名

适用场景：所有需要显示数据库内容的页面
关键问题：后台更改不反映在前端
更新：2025-06-27 解决了项目页面数据同步问题
```

### GitHub Pages 部署配置规范
```
部署最佳实践（2025-06-27 更新）：
1. 确保 astro.config.mjs 中的构建配置正确
2. 移除无效的 build.assets 和 terser 配置
3. 验证本地构建成功后再推送
4. 检查 GitHub Actions 构建日志
5. 确认 CSS 文件在 dist/_astro/ 中正确生成

常见问题：
- 构建失败：检查配置文件语法
- 样式丢失：检查 CSS 导入方式
- 页面空白：检查 JavaScript 错误

适用场景：静态站点部署到 GitHub Pages
更新：2025-06-27 优化了构建配置和部署流程
```

## 代码编辑规范

### 文件编辑最佳实践
```
在进行代码编辑时：
1. 始终使用 str-replace-editor 工具，不要重写整个文件
2. 编辑前必须先调用 codebase-retrieval 工具获取详细信息
3. 询问所有相关的符号、类、方法的详细信息
4. 在单次调用中获取所有需要的信息，避免多次调用
5. 保持对代码库的尊重，进行保守的修改

适用场景：所有代码文件编辑
使用条件：需要修改现有代码时
更新：2025-06-27 强化了信息收集要求
```

### 包管理规范
```
依赖管理规则：
1. 始终使用适当的包管理器而不是手动编辑配置文件
2. JavaScript/Node.js: 使用 npm install, yarn add, pnpm add
3. Python: 使用 pip install, poetry add, conda install
4. Rust: 使用 cargo add, cargo remove
5. 只有在复杂配置更改时才直接编辑包文件

适用场景：依赖管理和包安装
使用条件：需要添加或更新依赖时
更新：2025-06-27 明确了手动编辑的例外情况
```

### 代码显示规范
```
显示代码时的格式要求：
1. 使用 <augment_code_snippet> XML 标签包装代码
2. 提供 path= 和 mode="EXCERPT" 属性
3. 使用四个反引号 (````) 而不是三个
4. 保持简洁，只显示 <10 行关键代码
5. 让用户点击查看完整文件内容

示例：
<augment_code_snippet path="foo/bar.py" mode="EXCERPT">
````python
class AbstractTokenizer():
    def __init__(self, name):
        self.name = name
    ...
````
</augment_code_snippet>

适用场景：向用户展示代码片段
使用条件：需要显示代码内容时
更新：2025-06-27 确认格式规范的重要性
```

## 工具使用指南

### 信息收集流程
```
执行任务前的准备工作：
1. 使用 codebase-retrieval 工具了解代码库现状
2. 明确理解任务需求和范围
3. 收集所有必要的上下文信息
4. 制定详细的执行计划

适用场景：开始任何代码相关任务前
使用条件：对代码库不熟悉或需要修改代码时
更新：2025-06-27 在实际问题解决中验证了此流程的有效性
```

### 任务管理工具使用
```
复杂任务的管理策略：
1. 对于多步骤任务，考虑使用任务管理工具
2. 将工作分解为有意义的单元（约20分钟完成）
3. 避免过于细粒度的任务分解
4. 使用批量更新来高效管理任务状态
5. 及时更新任务进度和状态

适用场景：复杂的多步骤开发任务
使用条件：用户明确要求规划或任务较复杂时
更新：2025-06-27 明确了任务粒度要求
```

### 错误处理流程
```
遇到困难时的处理方式：
1. 如果反复调用相同工具无进展，主动寻求用户帮助
2. 避免陷入循环调用的困境
3. 清楚地说明遇到的具体问题
4. 提供可能的解决方案选项

适用场景：遇到技术难题或工具调用失败时
使用条件：连续尝试相同方法无效时
更新：2025-06-27 强调了主动求助的重要性
```

## 测试和验证规范

### 代码测试建议
```
代码修改后的验证流程：
1. 建议用户编写和运行测试
2. 优先编写单元测试验证功能
3. 通过测试迭代改进实现
4. 确保测试通过后再进行下一步

适用场景：完成代码修改后
使用条件：实现了新功能或修复了问题后
更新：2025-06-27 在社交媒体功能实现中应用了此原则
```

### 功能验证步骤
```
新功能实现的验证清单：
1. 数据库操作验证
2. API 函数测试
3. 前端显示确认
4. 用户交互测试
5. 错误处理验证

适用场景：实现新功能后的验证
使用条件：完成功能开发需要验证时
更新：2025-06-27 在社交媒体链接功能中完整应用了此清单
```

## Web 应用开发规范

### 框架选择指南
```
新 Web 应用的默认选择：
1. 前端：React with Vite 或 Next.js
2. 数据库和认证：Supabase
3. 使用 CLI 初始化工具而不是从零开始
4. 部署前使用 curl 测试网站可访问性

适用场景：创建新的 Web 应用项目
使用条件：用户没有明确指定框架时
更新：2025-06-27 确认用户偏好 Astro 框架
```

### 安全最佳实践
```
Supabase 多用户应用安全要求：
1. 实施行级安全 (RLS) 策略
2. 确保用户只能访问授权数据
3. 配置适当的 JWT 验证
4. 永远不要在客户端暴露服务密钥
5. 测试安全实现的有效性

适用场景：使用 Supabase 开发多用户应用
使用条件：涉及用户数据和权限控制时
更新：2025-06-27 在 social_links 表中实施了完整的 RLS 策略
```

## 用户交互规范

### 指令遵循原则
```
执行用户请求的基本原则：
1. 专注于用户明确要求的任务
2. 不要超出用户的请求范围
3. 对于潜在危险操作，寻求明确许可
4. 危险操作包括：提交代码、推送代码、合并分支、安装依赖、部署代码

适用场景：执行所有用户请求
使用条件：始终适用
更新：2025-06-27 强调了权限确认的重要性
```

### 沟通最佳实践
```
与用户沟通的有效方式：
1. 提供清晰的问题描述和解决方案
2. 使用结构化的格式组织信息
3. 及时反馈进度和结果
4. 主动询问不明确的需求
5. 提供具体的下一步建议

适用场景：与用户的所有交互
使用条件：始终适用
更新：2025-06-27 在问题解决过程中验证了结构化沟通的效果
```

## 特定场景提示词

### 数据库操作
```
Supabase 数据库操作规范：
1. 始终设置适当的 RLS 策略
2. 使用 UUID 作为主键
3. 包含 created_at 和 updated_at 时间戳
4. 为公共读取和认证用户修改设置不同策略

适用场景：创建或修改 Supabase 数据库表
使用条件：涉及数据库结构变更时
更新：2025-06-27 在 social_links 表创建中完整应用
```

### 前端开发
```
Astro 框架开发规范：
1. 在服务器端获取数据
2. 使用动态导入减少包大小
3. 保持组件的可重用性
4. 遵循 glassmorphism 设计系统

适用场景：使用 Astro 框架开发前端
使用条件：用户偏好 Astro 框架时
更新：2025-06-27 确认用户继续使用 Astro 的偏好
```

### 错误诊断
```
问题诊断的系统化方法：
1. 检查数据流：数据库 → API → 前端
2. 验证权限和安全策略
3. 检查缓存和数据绑定
4. 查看浏览器控制台错误
5. 验证网络请求状态

适用场景：遇到功能异常或数据显示问题
使用条件：需要诊断技术问题时
更新：2025-06-27 在个人信息显示问题中成功应用此方法
```

## 数据流问题专项提示词

### 多记录处理
```
处理数据库多记录冲突的最佳实践：
1. 避免使用 .single() 方法处理可能有多条记录的查询
2. 使用 .order() + .limit(1) 获取最新记录
3. 定期清理测试数据和重复记录
4. 在数据获取函数中添加适当的错误处理

适用场景：数据库查询返回多条记录时
使用条件：遇到 .single() 方法错误时
新增：2025-06-27 从实际问题中总结的经验
```

### 动态内容实现
```
实现动态内容显示的完整流程：
1. 设计数据库表结构和 RLS 策略
2. 实现 API 获取和更新函数
3. 在前端页面中集成数据获取逻辑
4. 创建管理后台编辑界面
5. 提供实时保存和反馈机制

适用场景：需要将硬编码内容改为动态管理
使用条件：实现内容管理系统时
新增：2025-06-27 从社交媒体链接功能实现中总结
```
